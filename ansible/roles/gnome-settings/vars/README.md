# GNOME Keybindings Management

This directory contains the keybindings configuration for GNOME desktop.

## Files

### `allowed_keybindings.yml` (Manual - Edit This)

This is your **whitelist** of keybindings that should be active. This is the file you edit to add or remove keybindings.

**Structure:**

```yaml
allowed_keybindings:
  - {
      schema: "org.gnome.settings-daemon.plugins.media-keys",
      key: "home",
      value: "['<Super>f']",
    }
  - {
      schema: "org.gnome.desktop.wm.keybindings",
      key: "close",
      value: "['<Super>x']",
    }
  # ... etc
```

### `keybindings.yml` (Auto-generated - Do Not Edit)

This is the **comprehensive** keybindings file that gets applied by Ansible. It contains:

- All your allowed keybindings (from `allowed_keybindings.yml`)
- ALL other GNOME keybindings set to disabled (`['']`)

**⚠️ Do not edit this file directly!** It will be overwritten when you regenerate.

## Workflow

### Adding a New Keybinding

1. **Find the schema and key** for the keybinding you want:

   ```bash
   # Search for a keybinding
   gsettings list-recursively | grep -i "your-search-term"

   # Example: Find screenshot keybinding
   gsettings list-recursively | grep -i screenshot
   ```

2. **Add to `allowed_keybindings.yml`:**

   ```yaml
   - {
       schema: "org.gnome.shell.keybindings",
       key: "show-screenshot-ui",
       value: "['Print']",
     }
   ```

3. **Regenerate `keybindings.yml`:**

   ```bash
   ./scripts/export_gnome_keybindings.sh
   ```

4. **Apply via Ansible:**
   ```bash
   ansible-playbook ansible/playbook.yml --tags gnome-settings
   ```

### Removing a Keybinding

1. Remove the entry from `allowed_keybindings.yml`
2. Regenerate: `./scripts/export_gnome_keybindings.sh`
3. Apply: `ansible-playbook ansible/playbook.yml --tags gnome-settings`

### Modifying a Keybinding

1. Edit the `value` in `allowed_keybindings.yml`
2. Regenerate: `./scripts/export_gnome_keybindings.sh`
3. Apply: `ansible-playbook ansible/playbook.yml --tags gnome-settings`

## Current Allowed Keybindings

The following keybindings are currently allowed (as of your configuration):

### Launchers

- **Home Folder**: `Super + F`
- **Calculator**: `Super + [`
- **Terminal**: `Super + T`
- **Web Browser**: `Super + B` (via custom shortcut)

### Screenshots

- **Take Screenshot Interactively**: `Print`

### System

- **Lock Screen**: `Super + L`
- **Log Out**: `Super + Escape`

### Windows

- **Close Window**: `Super + X`

### Custom Shortcuts

- **Open Steam**: `Super + S`
- **Open Discord**: `Super + D`
- **Open Notes**: `Super + N`
- **Open Work**: `Super + W`
- **Open Chrome**: `Super + B`
- **Open Gemini**: `Super + G`
- **Open YouTube**: `Super + Y`
- **Open Phone**: `Super + P`
- **Record Screen**: `Super + ]`

## How It Works

1. The export script (`scripts/export_gnome_keybindings.sh`) reads `allowed_keybindings.yml`
2. It queries all GNOME keybinding schemas on your system
3. It generates `keybindings.yml` with:
   - Your allowed keybindings with their configured values
   - All other keybindings set to `['']` (empty array = disabled)
4. The Ansible role applies this comprehensive list, ensuring ONLY your allowed keybindings are active

## Benefits

- ✅ **Single source of truth**: Only edit `allowed_keybindings.yml`
- ✅ **Complete control**: All default keybindings are explicitly disabled
- ✅ **Reproducible**: Regenerate anytime, on any system
- ✅ **Version controlled**: Small whitelist is easy to track in git
- ✅ **No conflicts**: Ensures no unexpected default keybindings remain active

## Troubleshooting

### Finding a keybinding schema

```bash
# List all available schemas
gsettings list-schemas | grep -i key

# List all keys in a schema
gsettings list-keys org.gnome.desktop.wm.keybindings

# Get current value of a key
gsettings get org.gnome.desktop.wm.keybindings close
```

### Verifying applied keybindings

```bash
# Check if a keybinding is disabled
gsettings get org.gnome.desktop.wm.keybindings minimize
# Should show: @as []  or  ['']

# Check your custom keybindings
gsettings get org.gnome.desktop.wm.keybindings close
# Should show: ['<Super>x']
```

### Script fails with YAML error

Make sure `allowed_keybindings.yml` is valid YAML:

```bash
python3 -c "import yaml; yaml.safe_load(open('ansible/roles/gnome-settings/vars/allowed_keybindings.yml'))"
```
